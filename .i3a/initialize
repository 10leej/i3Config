#!/bin/bash

#----------------------------------------------------------------------------------
# Project Name      - $HOME/.i3a/initialize
# Started On        - Sat 23 Sep 14:47:51 BST 2017
# Last Change       - Wed  1 Nov 21:38:24 GMT 2017
# Author E-Mail     - terminalforlife@yahoo.com
# Author GitHub     - https://github.com/terminalforlife
#----------------------------------------------------------------------------------

[ $UID -eq 0 ] && exit 1

BACKGROUND="/usr/share/wallpapers/road_fog_nature_trees_91499_1920x1080.jpg"
BELLSND="/usr/share/sounds/freedesktop/stereo/message.oga"
ALERTSND="/usr/share/sounds/freedesktop/stereo/window-attention.oga"
VOLCHSND="/usr/share/sounds/freedesktop/stereo/audio-volume-change.oga"
SOUND04="/usr/share/sounds/freedesktop/stereo/service-login.oga"
COMPCONF="$HOME/.config/compton.conf"

# Run a logging program for TCP connections.
[ -x $HOME/bin/tcpwatch ] && { $HOME/bin/tcpwatch & disown; }

# Set background (wallpaper) using feh or nitrogen; whichever is available.
{ [ -f "$BACKGROUND" ] && [ -r "$BACKGROUND" ]; } && {
	if [ -x /usr/bin/feh ]; then
		/usr/bin/feh --bg-center "$BACKGROUND" & disown
	elif [ -x /usr/bin/nitrogen ]; then
		/usr/bin/nitrogen "$BACKGROUND" & disown
	fi
}

# Be sure pulseaudio is enabled and set up the bell sound.
{ [ -x /usr/bin/pactl ] && [ -x /usr/bin/pulseaudio ]; } && {
	/usr/bin/pulseaudio --check || /usr/bin/pulseaudio --start & disown

	# Also load up an alert sound to be used by shell programs.
	{ [ -f "$ALERTSND" ] && [ -r "$ALERTSND" ]; } && {
		/usr/bin/pactl upload-sample $ALERTSND x11-alert & disown
	}

	# Also load up an notification sound to be used by shell programs.
	{ [ -f "$VOLCHSND" ] && [ -r "$VOLCHSND" ]; } && {
		/usr/bin/pactl upload-sample $VOLCHSND x11-volume-change
	}

	{ [ -f "$BELLSND" ] && [ -r "$BELLSND" ]; } && {
		/usr/bin/pactl upload-sample $BELLSND x11-bell & disown

		/usr/bin/pactl load-module module-x11-bell\
			sample=x11-bell display=$DISPLAY & disown
	}

	#TODO - Why won't this work!? It works when I enter it manually.
	# Get and export the device name of the source and sink. This is required
	# for various sound effects to work in this i3 setup.
	#while read -ra X; do
	#	if [[ "${X[@]%%: *}" == Default\ Source:\ * ]]; then
	#		printf -v PA_DEF_SOURCE "%s" "${X[2]}"
	#		export PA_DEF_SOURCE
	#	elif [[ "${X[@]%%: *}" == Default\ Sink:\ * ]]; then
	#		printf -v PA_DEF_SINK "%s" "${X[2]}"
	#		export PA_DEF_SINK
	#	fi
	#done <<< "$(eval env /usr/bin/pactl info short)"
}

# Enable the use of Ctrl + Alt + Backspace to kill X.
[ -x /usr/bin/setxkbmap ] && {
	/usr/bin/setxkbmap -option terminate:ctrl_alt_bksp & disown
}

[ -x /usr/bin/xsetroot ] && { /usr/bin/xsetroot -solid "#000000" & disown; }

# Set bell volume to 70%, disable DPMS (power-saving for your monitor), and set the
# keyboard repeat delay and rate.
[ -x /usr/bin/xset ] && /usr/bin/xset b 50 -dpms r rate 170 70

# Set this to disable your keyboard autorepeat; handy to improve your terminal or
# vim experience, once you quit raging at the lack of autorepeat! Overrides the
# keyboard setting above; this is intentional.
#[ -x /usr/bin/xset ] && /usr/bin/xset r off

# Remap F1 to Esc, and disable Caps Lock.
[ -x /usr/bin/xmodmap ] && {
	/usr/bin/xmodmap -e "keysym F1 = Escape" -e "clear lock" & disown
}

# Disallow user messages to display in the terminal.
[ -x /usr/bin/mesg ] && /usr/bin/mesg n & disown

# Load keynav to get mouse controls with a keyboard.
[ -x /usr/bin/keynav ] && /usr/bin/keynav & disown

[ -x /usr/bin/compton ] && {
	{ [ -f "$COMPCONF" ] && [ -r "$COMPCONF" ]; } && {
		/usr/bin/compton --config "$COMPCONF" -b & disown
	}
}

# Redshift sets the gamma to the neutral; default.
[ -x /usr/bin/redshift ] && { /usr/bin/redshift -O 6500K & disown; }

{ [ -f "$SOUND04" ] && [ -r "$SOUND04" ]; } && {
	[ -x /usr/bin/pactl ] && {
		/usr/bin/pactl --volume 40000 "$SOUND04" & disown
	}
}

# Check for kernel version changes; see kernelchk repository.
[ -x /usr/bin/kernelchk ] && { /usr/bin/kernelchk & disown; }

# Launches mocp in the background, ready for music.
[ -x /usr/bin/mocp ] && { /usr/bin/mocp -S & disown; }

# Log medication taken; see miscellaneous repository.
[ -x /usr/bin/medlog ] && { /usr/bin/medlog & disown; }

# Having a wallpaper slideshow, with a 10s interval.
{ [ -x /usr/bin/feh ] && [ -x /bin/sleep ]; } && {
	STWALLS="$HOME/Pictures/Wallpapers/Steampunk%20Wallpapers"
	while :; do
		for FILE in "${STWALLS//%20/ }"/*; {
			/usr/bin/feh --bg-center "$FILE"
			/bin/sleep 10
		}
	done & disown
}

# Launch Firefox, to ensure I get notifications from Facebook and YouTube.
[ -x /usr/bin/firefox ] && { /usr/bin/firefox & disown; }

# Launch Thunderbird. I often forget, so this helps me.
#[ -x /usr/bin/thunderbird ] && { /usr/bin/thunderbird & disown; }

# Give things enough time to load up before spamming update notifications.
sleep 1m

# Run notify-send and have it check for updates in the background. To get this
# small shell script, you can find it in the notify-upgrade repository.
[ -x /usr/bin/notify-upgrade ] && { /usr/bin/notify-upgrade & disown; }
